<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory Management</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
<div class="page-container">
  <div class="card">
    <h1>Inventory Management</h1>

    <!-- Inventory table -->
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Quantity</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="inventoryTableBody">
        <tr><td colspan="4">Loading inventory...</td></tr>
      </tbody>
    </table>

    <!-- Add new item -->
    <h2 style="margin-top:40px;">Add New Item</h2>
    <input type="text" id="ingredientName" placeholder="Ingredient Name" style="padding:8px; border-radius:6px; border:1px solid #b8390e; margin-right:10px;">
    <input type="number" id="ingredientQuantity" placeholder="Quantity" style="padding:8px; border-radius:6px; border:1px solid #b8390e; margin-right:10px; width:100px;">
    <button class="confirm" onclick="addItem()">Add Item</button>

    <div class="actions" style="margin-top:30px;">
      <a href="admin.html" class="confirm-btn">‚Üê Back to Dashboard</a>
    </div>
  </div>
</div>

<script>
const API_URL = "http://127.0.0.1:5000/api/v1/inventoryitem";

// Fetch all items and populate table
function fetchInventory() {
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("inventoryTableBody");
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4'>No items found</td></tr>";
        return;
      }

      data.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.ingredient_id}</td>
          <td>${item.ingredient_name}</td>
          <td>${item.ingredient_quantity}</td>
          <td>
            <button class="confirm" onclick="editItem(${item.ingredient_id}, '${item.ingredient_name}', ${item.ingredient_quantity})">Edit</button>
            <button class="cancel" onclick="deleteItem(${item.ingredient_id})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => console.error("Error fetching inventory:", err));
}

// Add new item
function addItem() {
  const name = document.getElementById("ingredientName").value.trim();
  const quantity = parseInt(document.getElementById("ingredientQuantity").value);

  if (!name || isNaN(quantity)) {
    alert("Please enter a valid name and quantity.");
    return;
  }

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ ingredient_name: name, ingredient_quantity: quantity })
  })
  .then(res => res.json())
  .then(() => {
    document.getElementById("ingredientName").value = "";
    document.getElementById("ingredientQuantity").value = "";
    fetchInventory();
  });
}

// Edit item (simple prompt for demo)
function editItem(id, currentName, currentQuantity) {
  const name = prompt("New Name:", currentName);
  const quantity = prompt("New Quantity:", currentQuantity);

  if (!name || quantity === null || isNaN(quantity)) return;

  fetch(`${API_URL}/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ ingredient_name: name, ingredient_quantity: parseInt(quantity) })
  })
  .then(res => res.json())
  .then(() => fetchInventory());
}

// Delete item
function deleteItem(id) {
  if (!confirm("Are you sure you want to delete this item?")) return;

  fetch(`${API_URL}/${id}`, { method: "DELETE" })
    .then(res => res.json())
    .then(() => fetchInventory());
}

// Initial load
fetchInventory();
</script>
</body>
</html>
